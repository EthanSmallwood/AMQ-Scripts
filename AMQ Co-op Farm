// ==UserScript==
// @name         AMQ Co-op Farm
// @namespace    http://tampermonkey.net/
// @version      0.6
// @description  Auto Farm respond and then press â†‘ so everyone get the answer !
// @author       Mxyuki
// @match        https://animemusicquiz.com/*
// ==/UserScript==


// don't load on login page
if (document.getElementById("startPage")) return;

// Wait until the LOADING... screen is hidden and load script
let loadInterval = setInterval(() => {
    if (document.getElementById("loadingScreen").classList.contains("hidden")) {
        clearInterval(loadInterval);
    }
}, 500);

var x='';
var ar='';
var on='1';

function sendChatMessage(message) {
    gameChat.$chatInputField.val(message);
    gameChat.sendMessage();
}
window.addEventListener("keydown", checkKeyPress, false)
function checkKeyPress(key) {
	if(key.keyCode=='38' && quiz.gameMode !== "Ranked" && on == 1) {

 x = document.getElementById("qpAnswerInput").value;
                        sendChatMessage('/// ' + x);
    }
    if(key.keyCode=='37') {
    if(on == 1){
    on = 0;
        gameChat.systemMessage("Disabled Auto Answer");
    }
        else{
        on = 1;
            gameChat.systemMessage("Enabled Auto Answer");
        }
    }
}

    new Listener("Game Chat Message", (payload) => {
	processChatCommand(payload);
}).bindListener();
new Listener("game chat update", (payload) => {
	payload.messages.forEach(message => {
		processChatCommand(message);
	});
}).bindListener();

    function processChatCommand(payload) {
if(payload.message.startsWith("///") && on == 1 && quiz.gameMode !== "Ranked") {
		var index=payload.message.indexOf(' ');
		if(index>0) ar=payload.message.substr(index+1);
		else ar='';
	if(quiz.isSpectator) return;
			if(ar.length>0) {
			quiz.skipClicked();
			$("#qpAnswerInput").val(ar);
			quiz.answerInput.submitAnswer(true);
        }
    }
}

    commandListener.bindListener();
